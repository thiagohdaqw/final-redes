import pytest
import server.websocket as ws

MENSAGEM_CURTA = "ola mundo"
MENSAGEM_CURTA_CODIFICADA = b"\x81\tola mundo"
MENSAGEM_CURTA_MASCARADA = b'\x81\x89A\x19\x95i.u\xf4I,l\xfb\r.'

MENSAGEM_LONGA = "01234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981990000"
MENSAGEM_LONGA_CODIFICADA = b'\x81\xfe\x01\xee\xc2S\x08\x13\xf2b: \xf6f>$\xfaj9#\xf3b9!\xf3`9\'\xf3f9%\xf3d9+\xf3j:#\xf0b:!\xf0`:\'\xf0f:%\xf0d:+\xf0j;#\xf1b;!\xf1`;\'\xf1f;%\xf1d;+\xf1j<#\xf6b<!\xf6`<\'\xf6f<%\xf6d<+\xf6j=#\xf7b=!\xf7`=\'\xf7f=%\xf7d=+\xf7j>#\xf4b>!\xf4`>\'\xf4f>%\xf4d>+\xf4j?#\xf5b?!\xf5`?\'\xf5f?%\xf5d?+\xf5j0#\xfab0!\xfa`0\'\xfaf0%\xfad0+\xfaj1#\xfbb1!\xfb`1\'\xfbf1%\xfbd1+\xfbj9#\xf2b8"\xf3c:"\xf2`9#\xf6b8&\xf3c>"\xf2d9#\xfab8*\xf3b8"\xf3b9"\xf0b9 \xf3b<"\xf3f9"\xf4b9$\xf3b0"\xf3j9!\xf2b:"\xf3a:"\xf0`9!\xf6b:&\xf3a>"\xf0d9!\xfab:*\xf3`8"\xf1b9 \xf0b; \xf3`<"\xf1f9 \xf4b;$\xf3`0"\xf1j9\'\xf2b<"\xf3g:"\xf6`9\'\xf6b<&\xf3g>"\xf6d9\'\xfab<*\xf3f8"\xf7b9&\xf0b= \xf3f<"\xf7f9&\xf4b=$\xf3f0"\xf7j9%\xf2b>"\xf3e:"\xf4`9%\xf6b>&\xf3e>"\xf4d9%\xfab>*\xf3d8"\xf5b9$\xf0b? \xf3d<"\xf5f9$\xf4b?$\xf3d0"\xf5j9+\xf2b0"\xf3k:"\xfa`9+\xf6b0&\xf3k>"\xfad9+\xfab0*\xf3j8"\xfbb9*\xf0b1 \xf3j<"\xfbf9*\xf4b1$\xf3j0"\xfbj8#\xf2c'
MENSAGEM_LONGA_MASCARADA = b'\x81\xfe\x01\xeen/\xeb3^\x1e\xd9\x00Z\x1a\xdd\x04V\x16\xda\x03_\x1e\xda\x01_\x1c\xda\x07_\x1a\xda\x05_\x18\xda\x0b_\x16\xd9\x03\\\x1e\xd9\x01\\\x1c\xd9\x07\\\x1a\xd9\x05\\\x18\xd9\x0b\\\x16\xd8\x03]\x1e\xd8\x01]\x1c\xd8\x07]\x1a\xd8\x05]\x18\xd8\x0b]\x16\xdf\x03Z\x1e\xdf\x01Z\x1c\xdf\x07Z\x1a\xdf\x05Z\x18\xdf\x0bZ\x16\xde\x03[\x1e\xde\x01[\x1c\xde\x07[\x1a\xde\x05[\x18\xde\x0b[\x16\xdd\x03X\x1e\xdd\x01X\x1c\xdd\x07X\x1a\xdd\x05X\x18\xdd\x0bX\x16\xdc\x03Y\x1e\xdc\x01Y\x1c\xdc\x07Y\x1a\xdc\x05Y\x18\xdc\x0bY\x16\xd3\x03V\x1e\xd3\x01V\x1c\xd3\x07V\x1a\xd3\x05V\x18\xd3\x0bV\x16\xd2\x03W\x1e\xd2\x01W\x1c\xd2\x07W\x1a\xd2\x05W\x18\xd2\x0bW\x16\xda\x03^\x1e\xdb\x02_\x1f\xd9\x02^\x1c\xda\x03Z\x1e\xdb\x06_\x1f\xdd\x02^\x18\xda\x03V\x1e\xdb\n_\x1e\xdb\x02_\x1e\xda\x02\\\x1e\xda\x00_\x1e\xdf\x02_\x1a\xda\x02X\x1e\xda\x04_\x1e\xd3\x02_\x16\xda\x01^\x1e\xd9\x02_\x1d\xd9\x02\\\x1c\xda\x01Z\x1e\xd9\x06_\x1d\xdd\x02\\\x18\xda\x01V\x1e\xd9\n_\x1c\xdb\x02]\x1e\xda\x00\\\x1e\xd8\x00_\x1c\xdf\x02]\x1a\xda\x00X\x1e\xd8\x04_\x1c\xd3\x02]\x16\xda\x07^\x1e\xdf\x02_\x1b\xd9\x02Z\x1c\xda\x07Z\x1e\xdf\x06_\x1b\xdd\x02Z\x18\xda\x07V\x1e\xdf\n_\x1a\xdb\x02[\x1e\xda\x06\\\x1e\xde\x00_\x1a\xdf\x02[\x1a\xda\x06X\x1e\xde\x04_\x1a\xd3\x02[\x16\xda\x05^\x1e\xdd\x02_\x19\xd9\x02X\x1c\xda\x05Z\x1e\xdd\x06_\x19\xdd\x02X\x18\xda\x05V\x1e\xdd\n_\x18\xdb\x02Y\x1e\xda\x04\\\x1e\xdc\x00_\x18\xdf\x02Y\x1a\xda\x04X\x1e\xdc\x04_\x18\xd3\x02Y\x16\xda\x0b^\x1e\xd3\x02_\x17\xd9\x02V\x1c\xda\x0bZ\x1e\xd3\x06_\x17\xdd\x02V\x18\xda\x0bV\x1e\xd3\n_\x16\xdb\x02W\x1e\xda\n\\\x1e\xd2\x00_\x16\xdf\x02W\x1a\xda\nX\x1e\xd2\x04_\x16\xd3\x02W\x16\xdb\x03^\x1f'


def test_encode_mensagem_em_um_frame():
    assert len(list(ws.encode_message(MENSAGEM_CURTA))) == 1

def test_formato_encode_mensagem_em_um_frame():
    encoded_msg = list(ws.encode_message(MENSAGEM_CURTA))[0]
    assert encoded_msg == MENSAGEM_CURTA_CODIFICADA

def test_decode_mensagem_curta():
    assert ws.decode_data(MENSAGEM_CURTA_MASCARADA) == MENSAGEM_CURTA

@pytest.mark.decode
def test_decode_mensagem_longa():
    assert ws.decode_data(MENSAGEM_LONGA_MASCARADA) == MENSAGEM_LONGA
